\chapter{Grundlagen}
\label{chap:grundlagen}
Das Kapitel Grundlagen behandelt die Themen, die in mehreren Abschnitten dieser Arbeit relevant sind. Dabei handelt es sich um das Robot Operation System, die verwendeten Koordinatensysteme und die Transformation zwischen ihnen.

\section{Das Robot Operation System \gls{ros}}
\label{sec:ros}
Ziel dieses Unterkapitel ist es das Opensource Betriebssystem \gls{ros} vorzustellen. Wie es aufgebaut ist und welche Vorzüge es besitzt.\\

\gls{ros} stellt dem Softwareentwickler Bibliotheken und Werkzeuge zur Verfügung, die Helfen Roboteranwendungen zu erstellen. Das auf einem \gls{ip}-basierende  modulare Kommunikationsframework ermöglicht die Verknüpfung von Anwendungssoftware, Sensoren und Aktoren sogar unter mehreren Robotern. Die Grundlage dafür ist die sogenannte Hardwareabstraktion. Dabei wird durch hardwarespezifische Module erreicht, das Komponenten unterschiedlicher Hersteller miteinander verbunden werden können. In unserem Fall Hokuyo Lasersanner und \gls{asctec} \gls{fcu}. Außerdem ermöglicht es eine hardwareunabhängige Programmierung, die  in den Programmiersprachen C/C++ oder in Python erfolgen kann. Jede Hardwareabstraktion oder Anwendung wird als Node, bzw. Konten bezeichnet und läuft als eigener Prozess.
\begin{figure}
	\centering
	\includegraphics[width = 0.75\textwidth]{images/TopicUndService}
	\caption[Topic und Service]{Kommunikation von Nodes über Topics und Services}
	\label{fig:node_kommunikation}
\end{figure}


Der Austausch von Daten zwischen den Nodes erfolgt über so genannte Topics (Abbildung \ref{fig:node_kommunikation}]. Dabei werden von den Knoten Nachrichten (engl. Messages) in Topics gepostet und somit veröffentlicht (publication). Benötigt ein weiter Knoten den Inhalt dieses Topic kann er es abonnieren (subscription). Sobald die Nachricht im Knoten aktualisiert wurde, wird sie den abonnierenden Knoten übertragen. Dabei sind Knoten nicht auf ein Topic beschränkt, es können beliebig viele Topics beschrieben oder empfangen werden. Alternative zu dieser Art der asynchronen Datenübertragung, biete \gls{ros} die Möglichkeit einer Synchrone Kommunikation zwischen zwei Nodes über Services. Dabei wird auf einem Knoten ein Service gestartet. Dieser dient als Server und agiert nach dem Anfrage-Antwort-Prinzip. Schickt ein anderer Knoten eine Anfrage, wird ihm die geforderte Nachricht zu gesendet. 

Anzumerken ist, das durch das verwendete \gls{ip}-Protokoll keine deterministische Versendung der Nachrichten nicht gewährleistet ist, da es sein kann, das Nachrichten gleichen Types in Paketen zusammengefasst werden. Bei der Programmierung empfiehlt es sich daher auf Topics mit einem Zeitstempel (engl. timestamp) zurückzugreifen. Die Echtzeitfähigkeit des \gls{ros} ist durch allerdings nicht gefährdet. 

\begin{figure}
	\centering
	\includegraphics[width = \textwidth]{images/MasterAndNode}
	\caption[Registrierung der Knoten]{Registrierung der Knoten}
	\label{fig:node_master}
\end{figure}


Der wohl größte Vorteil von \gls{ros} ist die ständig wachsende Community. So stellen Forscher aus der ganze Welt ihre Algorithmen und Hardwareabstraktionen zur Verfügung. Dadurch ist es möglich bei der Erstellung einer Roboteranwendung auf Bausteine zurück zugreifen, die ohne diese Plattform selbst zu implementieren wären. Abgesehen davon stellt ROS eine Vielzahl von Hilfsmitteln wie zum Beispiel die Transferfunktion (/tf) bereit. Hier lassen sich Koordinatensysteme definieren. Die Transformation der Daten wird dann automatisch von \gls{ros} durchgeführt.

\section{Einführung in die Koordinatensysteme und Koordinatentransformationen}
\label{sec:koordinatensysteme&transformationen}
Anhand von Koordinatensystemen und Transformationen lässt sich die Lage von Punkten und  Objekten in einen Raum mathematisch beschreiben. Die Grundvoraussetzung zur Bestimmung der Position des Quadrocopters im 2D-Raum (siehe Kapitel HIER MUSS NOCH EINE REFERENZ HIN). Außerdem ermöglicht die Einführung von Koordinatensystemen die mathematisch/physikalische Beschreibung des Quadrocopters und stellt somit die Grundlage zur Modellbildung und Reglerentwurf (siehe Kapitel so und so).  

\subsection{Koordinatensysteme}
\label{subsec:koordinatensysteme}
Über ein Koordinatensystem lässt sich ein Vektor oder die Position eines Punktes bezogen auf den Koordinatenursprung in einer zweidimensionalen Ebene, bzw in einem dreidimensionalen Raum beschreiben. Ziel diese Teilabschnittes ist die Erläuterung der in dieser Arbeit eingeführten Koordinatensysteme.\\

\begin{figure}
	
	\centering{
		\subfloat[ENU-Koordinatensystem]{
			\includegraphics[width=0.3\textwidth]{images/ENU-koordinatensystem}
			\label{fig:enu}
		}
		\subfloat[NED-Koordimatemsystem]{
			\includegraphics[width=0.3\textwidth]{images/ned-koordinatensystem}
			\label{fig:ned}
		}
	}
	\caption[Kovention ]{test}
	\label{fig:konventionen}
	
\end{figure}

Zu Beginn werden nun zwei Konventionen bezüglich der Bezugssysteme vorgestellt. Nummer eins, die in Abbildung \ref{fig:enu} dargestellte \gls{enu} Konvention. Diese wird in vor allem bei der Landnavigation eingesetzt. Hier zeigt die z-Achse nach oben. Bei der zweiten Konvention, hauptsächlich in der Wasser-, Luft- und Raumfahrt eingesetzt, handelt es sich um das \gls{ned} Bezugssystem (Abbildung \ref{fig:ned}). Die z-Achse zeigt nach unten. Anzumerken ist, das in dieser Arbeit die Ausrichtung der x- und y -Achse nicht wie in Abbildung \ref{fig:konventionen} und auch der Namensgebung entsprechend den Himmelsrichtungen entspricht. Die Begriffe \gls{enu} und \gls{ned} dienen hier zur Beschreibung der Ausrichtung der Koordinatenachsen in Abhängigkeit der positiven z-Achse.

Bei der nun folgenden Einführung der Koordinatensysteme (Abbildung \ref{fig:koordinatensysteme}) handelt es ausschließlich um kartesische, das heißt orthogonale Koordinatensysteme, die nach der \gls{enu} Konvention ausgerichtet sind. Dies steht erstmal im Widerspruch mit dem Abschnitt zuvor, dort ist das \gls{ned} als Koordinatensystem für Flugkörper eingeführt worden. Es ist allerdings so, dass die \gls{ros} Koordinatensysteme auf \gls{enu} basieren. Deshalb die Wahl von Bezugssystemen mit positiver z-Achse nach oben.

\begin{figure}
	\centering
	\includegraphics[width = \textwidth]{images/Koordinatensysteme}
	\caption[Koordinatensysteme]{In der Arbeit angewandte Koordinatensysteme }
	\label{fig:koordinatensysteme}
\end{figure}

Wie aus Abbildung \ref{fig:koordinatensysteme} zu entnehmen sind vier xyz-Koordinatensysteme definiert. 

\begin{itemize}
	\item \textbf{n-frame(Lokaler Navigationsframe):} Ortsfestes Koordinatensystem zur Beschreibung der Position im Raum. Da es in dieser Arbeit um die horizontale Positionsregelung geht, ist hier ausschließlich die xy-Ebene von Interesse. Der Ursprung des Koordinatensystem wird bei jedem Systemstart neu initialisiert. Zu beachten ist dies beim vollautonomen Flug in Räumen, dabei beziehen sich die Sollpositionen nicht auf ein Raumkoordinatensystem mit festem Ursprung, sondern auf den beim Systemstart initialsierten Bezugspunkt. Keinen Einfluss hat diese Tatsache auf die Geschwindigkeitsregelung per Fernsteuerung, da hier die relative Bewegung von Interesse ist.
	
	Es sei darauf hingewiesen, dass die Verwendung eines xyz Navigationsframes die Krümmung der Erdoberfläche vernachlässigt. Diese ist legitim, da die Drohne in Gebäuden zum Einsatz kommt. Möchte man jedoch Weltweit navigieren, benötigt man ein  
	rotationsellipsische Koordinatensysteme[THIELECKE LITVERWEIS]

	\item \textbf{b-frame(Bodyframe):} Dieses Koordinatensystem ist fest mit dem Rahmen des Quadrocopters verbunden. Man spricht dabei von einen körperfesten Koordinatensystem. Dabei befindet sich der Ursprung des Systems im Schwerpunkt, die x-Achse zeigt in die als Vorne definierte Richtung. Die y- und z-Achse sind abhängig davon nach der \gls{enu} Konvention angeordnet. Informationen die sich auf dieses Referenzsystem beziehen sind unter anderen die \gls{imu}-Daten. Außerdem lässt sich mit diesem System die Lage des Quadrocoters im n-frame über die Position des Nullpunkts und Drehwinkel beschreiben. 
	 	
	\item \textbf{l-frame(laserframe):} Ebenfalls ein körperfestes Koordinatensystem. In die dem Entfernungsmessungen des Lasers aufgetragen werden. Der Bezugspunkt liegt dabei in der Sendequelle des Lasers. Die Ausrichtung der Achsen entspricht der des b-frames, mit Ausnahme eines Offsets in z-Richtung.
	
	\item \textbf{o-frame(Orthogonalframe):} Hierbei handelt es sich um ein objektbezogenes Bezugssystem, dessen Orientierung um seine z-Achse und die Position des Ursprungs im n-frame abhängig von dem Orthogonal über der Ebene befindlichen b-frame ist. Dadurch wird der Quadrocopter in der zu Navigierenden xy-Ebene abgebildet.  
	
	 \end{itemize}
 
Da sich Messwerte wie zum Beispiel die \gls{imu}-Daten oder die Laserdaten auf unterschiedlichen Koordinatensysteme beziehen, benötigt man Koordinatentransformation(Kapitel \ref{subsec:koordinatentransformation}). Mit Hilfe derer lassen sich die Vektoren und Koordinaten in die verschiedenen Bezugssysteme übertragen.

 
\subsection{Koordinatentransformationen}
\label{subsec:koordinatentransformation}
Damit Daten eines Referenzsystem in einen anderes Transformiert werden können, muss deren Orientierung zueinander beschreibbar sein. Nach  [Buchholz Flugregelung] ist dies über die Rotationswinkel $\phi$ (Rollwinkel/engl. roll), Rotation um die x-Achse sowie der Winkel $\theta$ (Nickwinkel/engl. pitch) und $\psi$ (Gierwinkel/engl. yaw) für die y- und z-Achse möglich. Die Reihenfolge um die die Achsen gedreht werden, ist dabei nicht beliebig. Sie ist in verschiedenen Konventionen festgelegt. In dieser Arbeit wird die in der Luftfahrt- und Fahrzeugtechnik gebräuchliche z,y',x''- Konvention (Abbildung \ref{fig:zyx_konvention}) angewendet.   

\begin{figure}
	\centering
	\includegraphics[width = .75\textwidth]{images/zyx_konvention}
	\caption[z,y',x''-Konvention]{z,y',x''-Konvention}
	\label{fig:zyx_konvention}
\end{figure}

Das Koordinatensystem wird zu beginn um den Winkel $\psi$, d.h. um die z-Achse gedreht. Daraus ergibt sich das in Abbildung \ref{fig:zyx_konvention} grün eingezeichnet Koordinatensystem. Dieses rotiert man anschließend um die Achse y', sprich den Winkel $\theta$. Zuletzt erfolgt eine Drehung mit dem Winkel $\phi$ um die x''-Achse. Das Ergebnis ist das rote x'',y'',z''-Koordinatensystem. Es sein nochmal darauf hinzuweisen, das die Reihenfolge der Winkel einzuhalten ist, da sonst die beschriebene von der tatsächlichen Lage abweicht. Ein veranschaulichendes Beispiel worin unterschiedliche Abfolgen bei der Rotation führen ist in der Literatur [Literaturverzeichnis] von Herr Thielecke zu finden.  

Nach Luftfahrtkonvention lässt sich eine Transformationsmatrix $M$ aufstellen, mit der Vektoren und Koordinaten vom xyz-Koordinatensystem (Bsp.: n-frame) in das x''y''z''-Koordinatensystem (Bsp.: b-frame) überführen lassen. Dafür benötigt man zunächst die drei Transformationsmatrizen, die jeweils eine Rotation um eine Koordinatenachse beschreiben[Literaturverzeichnis]. Diese sind wie folgt definiert:

\begin{itemize}
	\item Drehung um die z-Achse mit dem Winkel $\psi$
	\begin{equation}
		M_z = \begin{bmatrix}
		\cos\psi 	& \sin\psi	& 0\\
		-\sin\psi	& \cos\psi	& 0\\
		0			& 0 		& 1\\
		\end{bmatrix}
	\end{equation}
	\item Drehung um die y-Achse mit dem Winkel $\theta$
	\begin{equation}
	M_y = \begin{bmatrix}
	\cos\theta  & 0	& -\sin\theta\\
	0			& 1	& 0\\
	\sin\theta	& 0 & \cos\theta\\
	\end{bmatrix}
	\end{equation}
	\item Drehung um die x-Achse mit dem Winkel $\phi$
	\begin{equation}
	M_x = \begin{bmatrix}
	1	& 0			& 0\\
	0	& \cos\phi	& \sin\phi\\
	0	& -\sin\phi 	& \cos\phi\\
	\end{bmatrix}
	\end{equation}
\end{itemize}

Aus diesen Rotationsmatrizen lässt sich über Matrizenmultiplikation eine Gesamttransformationsmatrix aufstellen. Die Reihenfolge der Multiplikation entspricht der in der Konvention festgelegten Drehfolge, von rechts nach links gelesen. Somit er gibt sich:

	\begin{equation}
	\begin{split}
	M_{bn} &	= M_x \cdot M_y \cdot M_z \\
	&= \begin{bmatrix}
	\cos\theta\cos\psi	& \cos\theta\sin\psi	& -sin\theta\\
	\sin\phi\sin\theta\cos\psi-\cos\phi\sin\psi	& \sin\phi\sin\theta\sin\psi+\cos\phi\cos\psi	& \sin\phi\cos\theta\\
	\cos\phi\sin\theta\cos\psi+\sin\phi\sin\psi	& \cos\phi\sin\theta\sin\psi-\sin\phi\cos\psi 	& \cos\phi\cos\theta\\
	\end{bmatrix}
	\end{split}
	\end{equation}

Mit Hilfe dieser Transformationmatrix lässt sich jetzt ein Vektor zum Beispiel aus dem n-frame ins b-frame übertragen.

\begin{equation}
\begin{bmatrix}
x_b\\
y_b\\
z_b\\	
\end{bmatrix} = M_{bn} \cdot 
\begin{bmatrix}
x_n\\
y_n\\
z_n\\	
\end{bmatrix} 
\end{equation}

Handelt es sich bei um eine Koordinate, ist zusätzlich noch der Abstand der Koordinatenursprünge zu addieren. Für die Rücktransformation muss die Gesamttransformationsmatrix transponiert werden. Daraus folgt,

   \begin{equation}
   \begin{bmatrix}
   x_n\\
   y_n\\
   z_n\\	
   \end{bmatrix} = M_{bn}^T \cdot 
   \begin{bmatrix}
   x_b\\
   y_b\\
   z_b\\	
   \end{bmatrix} = M_nb \cdot 
   \begin{bmatrix}
   x_b\\
   y_b\\
   z_b\\	
   \end{bmatrix}
   \end{equation}

Nun lassen sich Vektoren in beide Richtungen in die verschiedenen Bezugssysteme überführen. Nachteil der Methode mit Eulerwinkel ist, das diese auf Grund der trigonometrischen Funktionen nur für Winkel $\phi, \theta, \psi = \{x \in  \mathbb{R}| -\pi \le x \le \pi\}$ eindeutig durchführbar ist. Wird dieser Bereich überschritten, lässt sich die Lage über Quaternionen beschreiben. Durch die Beschreibung der dreidimensionalen Orientierung in einem vierdimensionalen Raum lassen, ist die Lage auch für Rotationen um eine vielfaches von $2\pi$ eindeutig charakterisiert. Die genaue Definition findet sich in der  Literatur [THIELECKE] und [YOUTUBE]. Da die Definitionsbereich der Eulerwinkel für den in der Arbeit betrachteten Bereich ausreicht ist ausschließlich die Umrechnung der in Quaternion ($w_q$, $x_q$, $y_q$, $z_q$) angegebenen Orientierungsdaten der \gls{imu} in Eulerwinkel($\phi$, $\theta$, $\psi$). Zu beachten ist, das die nun folgende Umwandlung nur für die $z,y',x''$-Konvention Gültigkeit besitzt. 
  
   \begin{equation}
	   \phi = \arctan(\frac{2(y_qz_q+w_qx_q)}{w_q^2-x_q^2-y_q^2+z_q^2})\\
	\end{equation}
   \begin{equation}
	  \theta =\arcsin(2(w_q y_q -x_q z_q))\\
   \end{equation}
   \begin{equation}
     \psi = \arctan(\frac{2(x_q y_q + w_q z_q)}{w_q^2+x_q^2-y_q^2-z_q^2})
   \end{equation}
 
 Mit dieser letzten Umrechnung sind alle Grundlagen für die Arbeit gelegt. So bilden die Koordinatensystem und Transformationen die Basis für die nachkommende Positionsbestimmung. 
